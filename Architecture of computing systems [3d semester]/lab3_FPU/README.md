# Имитационная модель стекового математического сопроцессора

Реализована эмуляция (упрощённая) процессора с восемью регистрами и стековой адресацией. Реализована работа чисел с плавающей запятой и управление с помощью следующих команд:
- `PUSH val` кладёт `val` в вершину стека
- `CPY d` копирует значение, лежащее на расстоянии `d` от вершин стека и кладёт её наверх
- `POP` удаляет верхний элемент
- `SWP` меняет местами два верхних элемента
- `ADD` удаляет два верхних элемента и записывает их сумму
- `SUB` удаляет два верхних элемента и записывает их разницу
- `DIV` удаляет два верхних элемента и записывает их частное
Для бинарных функций (`ADD`, `SUB`, `DIV`) левым аргументом является тот, что лежал в стеке выше.

### Пример программы (`commands.com`):
Программа, которая добавляет в стек два вещественных числа `a`, `b`, производит некоторые операции и оставляет единственным элементом стека значение `(a+b)/(b-a)`
```
; comment has implemented
; floats always must contain decimal dot
PUSH 2.5    ; a
PUSH 3.1415 ; b
CPY 1     ; =a
CPY 1     ; =b
; stack = [a, b, a, b]
SUB       ; = b-a
; [a, b, b-a]
CPY 2     ; =a
CPY 2     ; =b
; [a, b, b-a, a, b]
ADD
; [a, b, b-a, a+b]
DIV       
; [a, b, (a+b)/(b-a)]
SWP
POP
SWP
POP
; [(a+b)/(b-a)]
```

Значение регистров изначально (хранятся случайные значения):
```
 R_comm  : PUSH 2.5
 R0      : 1_0110100110_00110100 (-1.943753e-27)
 R1      : 0_0001011100_01000111 (+9.434950e-127)
 R2      : 1_1000100101_10101101 (-4.606352e+11)
 R3      : 1_0010110111_11110110 (-3.586123e-99)
 R4      : 1_0110100011_00110110 (-2.445469e-28)
 R5      : 1_0011000100_10001000 (-2.294021e-95)
 R6      : 0_1010001001_11111100 (+6.914538e+41)
 R7      : 0_1010100000_01111110 (+4.361669e+48)
 R_ss    : 00000000 (0)
 R_state : 00000000 (0)
 R_tick  : 00000000 (0)
 R_cTick : 00000001 (1)
```

Значение регистров после выполнения:
```
 R_comm  : POP 
 R0      : 0_1000000010_00011001 (+8.781250e+00)
 R1      : 0_1000000000_01000000 (+2.500000e+00)
 R2      : 0_1000000000_10010010 (+3.140625e+00)
 R3      : 0_1000000001_01101001 (+5.640625e+00)
 R4      : 0_1000000000_10010010 (+3.140625e+00)
 R5      : 1_0011000100_10001000 (-2.294021e-95)
 R6      : 0_1010001001_11111100 (+6.914538e+41)
 R7      : 0_1010100000_01111110 (+4.361669e+48)
 R_ss    : 00000001 (1)
 R_state : 00000000 (0)
 R_tick  : 00000001 (1)
 R_cTick : 00001101 (13)
```

Из-за использования относительно небольшого количества битов в представлении числа (10 на экспоненту и 8 на мантиссу) при делении `(2.5+3.1415)/(3.1415-2.5)` получили ответ в вершине стека `8.78125`, что на `0.14%` отличается от правильного (`≈8.79423`).
Само количество битов задаётся константами в `main.py`. Отчасти реализована поддержка `NaN`, `±Inf`, `±0.0`.
Упревление стеком реализовано за счёт регистра `R_ss` (Stack Selector), указывающего на первый незанятый регистр в стеке. 
